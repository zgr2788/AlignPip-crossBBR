# Snakefile module for all actions regarding sampleTable -> fasterq
# pipeline.
#
# @zgr2788


rule getTables:
	input:
		str(tablePrefix + ".csv")

	output:
		getTables()

	benchmark:
		"Benchmarks/getTables.txt"

	shell:
		"bash Modules/SRActions/extractTables.sh {tablePrefix}"



rule fetchSraSingle:
	input:
		getTables()[0]

	output:
		getSRA("single")

	shell:
		"""
                 prefetch \ 
                 -X 99999999999999 \ 
                 -O Single/ \
		 --option-file {input}
		"""



rule fetchSraPaired:
	input:
		getTables()[1]
	
	output:
		getSRA("paired")

	shell:
                """ 
                 prefetch \ 
                 -X 99999999999999 \ 
                 -O Paired/ \ 
                 --option-file {input} 
                """



rule writeFastqSingle:
	input:
		"Single/{runID}/{runID}.sra"

	output:
		"Single/{runID}/{runID}.fastq"

	benchmark:
		"Benchmarks/{runID}/{runID}_fasterqdump.txt"

	resources:
		mem_mb = 16000
	
	threads: 8

	shell:
		"""
		 fasterq-dump \
                 --threads 8 \ 
                 -O Single/{wildcards.runID} \ 
                 Single/{wildcards.runID}
		"""



rule writeFastqPaired:
	input:
		"Paired/{runID}/{runID}.sra"
	
	output:
		"Paired/{runID}/{runID}_1.fastq",
		"Paired/{runID}/{runID}_2.fastq"

	benchmark:
		"Benchmarks/{runID}/{runID}_fasterqdump.txt"

	resources:
		mem_mb = 16000

	threads: 8

	shell:
		"""
		 fasterq-dump \
                 --threads 8 \
                 -O Paired/{wildcards.runID} \
                 Paired/{wildcards.runID}
		"""

